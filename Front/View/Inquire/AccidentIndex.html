<?php echo $header_page; ?>
<body>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=TTF3dTuwduGkNwm6YdzTCg6MhT8M6Tm3"></script>
<script type="text/javascript">
    $(document).ready(function(){
        // 百度地图API功能
        var map = new BMap.Map("allmap");
        var point = new BMap.Point(116.331398,39.897445);
        map.centerAndZoom(point,12);

        var geolocation = new BMap.Geolocation();
        geolocation.getCurrentPosition(function(r){
            if(this.getStatus() == BMAP_STATUS_SUCCESS){
                var mk = new BMap.Marker(r.point);
                map.addOverlay(mk);
                map.panTo(r.point);
                //alert('您的位置：'+r.point.lng+','+r.point.lat);
                st.post('<?php echo $entrance; ?>route=Front/Inquire/Inquire/ajax_get_accident', {x:r.point.lng,y:r.point.lat}, function(data){
                    if (data.result.length > 0) {
                        var titles = [];
                        titles['address'] = '路段地址';
                        titles['city'] = '城市';
                        titles['detail'] = '详细描述';
                        titles['level'] = '事故频率';
                        titles['num'] = '事故次数';

                        $.each(data.result, function(k, v){
                            var d = '';
                            $.each(v, function(k1, v1){
                                if (!!titles[k1]) {
                                    d += '<div class="list-group-item py-1 border-0">';
                                    d += '<span class="pull-right text-muted">'+v1+'</span><span class="text-primary">●</span> '+titles[k1];
                                    d += '</div>';
                                }
                            });
                            var div_dom = '<div class="list-group small py-1"><header class="panel-heading bg-transparent"><h4 class="panel-title">事故</h4></header>' + d + '</div>';

                            $("#content").append(div_dom);
                        });
                    }
                });
            }
            else {
                alert('failed'+this.getStatus());
            }
        },{enableHighAccuracy: true})
        //关于状态码
        //BMAP_STATUS_SUCCESS	检索成功。对应数值“0”。
        //BMAP_STATUS_CITY_LIST	城市列表。对应数值“1”。
        //BMAP_STATUS_UNKNOWN_LOCATION	位置结果未知。对应数值“2”。
        //BMAP_STATUS_UNKNOWN_ROUTE	导航结果未知。对应数值“3”。
        //BMAP_STATUS_INVALID_KEY	非法密钥。对应数值“4”。
        //BMAP_STATUS_INVALID_REQUEST	非法请求。对应数值“5”。
        //BMAP_STATUS_PERMISSION_DENIED	没有权限。对应数值“6”。(自 1.1 新增)
        //BMAP_STATUS_SERVICE_UNAVAILABLE	服务不可用。对应数值“7”。(自 1.1 新增)
        //BMAP_STATUS_TIMEOUT	超时。对应数值“8”。(自 1.1 新增)
    });
</script>
<div id="allmap" style="display: none;"></div>
<header class="navbar navbar-fixed-top">
    <h4 class="navbar-text">事故查询</h4>
    <a href="<?php echo $entrance; ?>route=Front/Inquire/Inquire" class="btn btn-link navbar-btn pull-left"><i class="nc-icon-outline arrows-1_minimal-left"></i> 返回</a>
</header>
<main class="main">
    <?php if(!empty($error_info)): ?>
    <div class="form-group">
        <div class="input-group">
            <span class="input-group-addon" style="color:red;"><label><?php echo $error_info; ?></label></span>
        </div>
    </div>
    <?php else: ?>
    <section class="panel panel-default border-horizontal-0"  id="content">
        <!--<header class="panel-heading bg-transparent">
            <h4 class="panel-title">标题</h4>
        </header>
        <div class="list-group small py-1">
            <div class="list-group-item py-1 border-0">
                油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称油站名称
            </div>
            <div class="list-group-item py-1 border-0">
                <span class="pull-right text-muted">-38.40</span><span class="text-primary">●</span> 标题
            </div>
            <div class="list-group-item py-1 border-0">
                <span class="pull-right text-muted">-822.05</span><span class="text-primary">●</span> 标题
            </div>
            <div class="list-group-item py-1 border-0">
                <span class="pull-right text-muted">-948.00</span><span class="text-primary">●</span> 标题
            </div>
            <div class="list-group-item py-1 border-0">
                <span class="pull-right text-muted">-12.00</span><span class="text-primary">●</span> 标题
            </div>
        </div>-->
    </section>
    <?php endif; ?>
</main>

<?php echo $footer_page; ?>